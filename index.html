<!DOCTYPE html>
<html lang="en">
<head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dongle&family=Jua&display=swap" rel="stylesheet">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="images/gascalicon.png">
<title>HPMA Gastronomy Calculator</title>
<style>
  body {
    background-image: url('cozyfire.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    height: 100vh;
    margin: 0;
    background-color: #fce5cd;
    font-family: 'Tahoma', sans-serif;
    max-width: 600px;
    margin: 2rem auto;
    padding: 0 1rem;
    color: #783f04;
  }
  .glow-text {
  color: #fff8e1;
  text-shadow: 0 0 5px #b45f06, 0 0 10px #b45f06, 0 0 15px #b45f06;
  }
  .credit {
    position: absolute;
    top: 2px;
    right: 10px;
    font-size: 1rem;
    color: #fff8e1;
    padding: 5px 10px;
    border-radius: 8px;
    font-family: 'Dongle', sans-serif;
  }

  .tabs {
    display: flex;
    justify-content: flex-start;
    margin-bottom: 0;
    width: 340px;
    margin: 0 auto;
  }

  .tab {
    padding: 0.3rem 0.4rem;
    cursor: pointer;
    background-color: #b45f06;
    color: #fff8e1; 
    border-bottom: none;
    border-radius: 6px 6px 0 0;
    font-family: 'Tahoma', sans-serif;
    font-size: 1rem;
    margin-right: 2px;
    transition: background-color 0.3s;
  }

  .tab.active {
    background-color: rgba(252, 229, 205, 0.7);
    color: #783f04; 
    font-weight: bold;
  }
  .tab:not(.active):hover {
    background-color: #783f04;
  }

  .calculator-box {
    background-color: rgba(252, 229, 205, 0.7);
    border-radius: 0px 16px 16px 16px;
    padding: 20px;
    width: 300px;
    margin: 0 auto 50px;
    box-shadow:
    0 0 5px #e7a45e,
    0 0 10px #e7a45e,
    0 0 15px #e7a45e,
    0 0 20px #e7a45e;
    text-align: center;
  }

  label {
    display: block;
    margin: 1rem 0 0.5rem;
  }

  select, input {
    width: 80%;
    padding: 0.4rem;
    font-size: 1rem;
    margin-bottom: 0.5rem;
    border-radius: 8px;
    background-color: #fff8e1;
    box-shadow: inset 2px 2px 4px rgba(0,0,0,0.1);
  }

  #progress {
    margin-right: 0.5rem;
  }

  button {
    margin-top: 1rem;
    padding: 0.6rem;
    font-size: 1rem;
    width: 50%;
    cursor: pointer;
    background-color: #b45f06;
    color: #fff8e1; 
    border: none;
    border-radius: 10px;
    font-family: 'Tahoma', sans-serif;
    transition: background-color 0.3s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
  }

  button:hover {
    background-color: #783f04;
  }

  #result, #timeResult {
    margin-top: 1.5rem;
    font-weight: bold;
    white-space: pre-wrap;
  }
   .timestamp {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 0.25rem;
    font-family: Tahoma, sans-serif;
    font-weight: bold;
  }
  .copy-image {
    width: 20px;
    height: 20px;
    cursor: pointer;
    transition: transform 0.2s ease;
    margin-left: 8px;
  }

  .copy-image:hover {
    transform: scale(0.85);
  }
  .dish-group {
    margin-bottom: 1rem;
  }
  #startTime {
    font-family: 'Tahoma', sans-serif;
}
</style>
</head>
<body>
<div class="credit">Created by Fyrverkeri</div>
<h1 class="glow-text" style="text-align:center;">HPMA Gastronomy Calculator</h1>
<div class="tabs">
  <div class="tab active" onclick="switchTab('expTab')">EXP</div>
  <div class="tab" onclick="switchTab('researchTab')">Research</div>
  <div class="tab" onclick="switchTab('harvestTab')">Commission Timer</div>
</div>
<div id="expTab" class="calculator-box">
  <label for="currentLevel">Current Level</label>
  <select id="currentLevel"></select>

  <label for="targetLevel">Target Level</label>
  <select id="targetLevel"></select>

  <label for="progress">Progress into Current Level (EXP)</label>
  <input type="number" id="progress" min="0" value="0" />

  <label for="talentLevel">Faster Than Flame Talent Level</label>
  <select id="talentLevel">
    <option value="0">0 (None)</option>
    <option value="1">1 (5% faster, unlocks at Kitchen Hand I)</option>
    <option value="2">2 (10% faster, unlocks at Apprentice cook I)</option>
    <option value="3">3 (15% faster, unlocks at Sous Chef I)</option>
    <option value="4">4 (20% faster, unlocks at Head Chef I)</option>
    <option value="5">5 (25% faster, unlocks at Culinary Virtuoso I)</option>
  </select>

  <label for="delegatoLevel">The Delegator Talent Level</label>
  <select id="delegatoLevel">
    <option value="0">0 (1 station)</option>
    <option value="1">1 (2 stations, unlocks at Sous Chef I)</option>
    <option value="2">2 (3 stations, unlocks at Head Chef I)</option>
  </select>

  <button onclick="runCalculation()">Calculate</button>
  <div id="result"></div>
</div>

<div id="researchTab" class="calculator-box" style="display:none">
  <label for="recipeSelect">Select Recipe</label>
  <select id="recipeSelect">
    <option value="0"> </option>
    <option value="1">Gilded Shore Risotto (8 hr, 4 exp)</option>
    <option value="2">Farmstead Feast Roast (6 hr, 3 exp)</option>
    <option value="3">Woodland Mushroom Risotto (4 hr, 2 exp)</option>
    <option value="4">Braised Venison Stew (8 hr, 4 exp)</option>
    <option value="5">Hearty Custard Pie (6 hr, 3 exp)</option>
    <option value="6">Paleleaf Meat Roll (6 hr, 3 exp)</option>
    <option value="7">Saltbaked Shrimp (6 hr, 3 exp)</option>
  </select>

  <div id="researchTasks" style="margin-top: 10px;"></div>

  <label for="dishAmount">Commission Target</label>
  <input type="number" id="dishAmount" min="1" value="1" />

  <label for="timeTalentLevel">Faster Than Flame Talent Level</label>
  <select id="timeTalentLevel">
    <option value="0">0 (None)</option>
    <option value="1">1 (5% faster, unlocks at Kitchen Hand I)</option>
    <option value="2">2 (10% faster, unlocks at Apprentice cook I)</option>
    <option value="3">3 (15% faster, unlocks at Sous Chef I)</option>
    <option value="4">4 (20% faster, unlocks at Head Chef I)</option>
    <option value="5">5 (25% faster, unlocks at Culinary Virtuoso I)</option>
  </select>

  <label for="timeDelegatoLevel">The Delegator Talent Level</label>
  <select id="timeDelegatoLevel">
    <option value="0">0 (1 station)</option>
    <option value="1">1 (2 stations, unlocks at Sous Chef I)</option>
    <option value="2">2 (3 stations, unlocks at Head Chef I)</option>
  </select>

  <button onclick="calculateTime()">Calculate</button>
  <div id="timeResult"></div>
</div>

<div id="harvestTab" class="calculator-box" style="display:none">
  <label for="startTime">Start Date and Time</label>
  <input type="datetime-local" id="startTime" />

  <label for="harvestTalent">Faster Than Flame Talent Level</label>
  <select id="harvestTalent"></select>

  <label>Commission Queue</label>
  <div id="commissionSelector"></div>
<div style="display: flex; align-items: center; gap: 0.5em;">
  <label for="commissionHours" style="white-space: nowrap; line-height: 1.6;">Time Left:</label>
  <input type="number" id="commissionHours" min="0" max="23" placeholder="Hours" style="width: 50px; height: 20px;" /> :
  <input type="number" id="commissionMinutes" min="0" max="59" placeholder="Minutes" style="width: 50px; height: 20px;" />
</div>

  <label>Reserved Queue</label>
  <div id="reservedSelectors"></div>
  <button id="bulkCopyButton" style="display:none; margin-top:10px;">Copy All</button>
  <div id="harvestTotalExp" style="margin-top: 1em; font-weight: bold;"></div>
  <button onclick="calculateHarvestTimes()">Calculate</button>
</div>

<script>

const levels = ["Kitchen Hand I", "Kitchen Hand II", "Kitchen Hand III", "Apprentice Cook I", "Apprentice Cook II", "Apprentice Cook III", "Sous Chef I", "Sous Chef II", "Sous Chef III", "Head Chef I", "Head Chef II", "Head Chef III", "Culinary Virtuoso I", "Culinary Virtuoso II", "Culinary Virtuoso III", "Master of Flavour I", "Master of Flavour II", "Master of Flavour III", "MAX"];
const expPerLevel = {"Kitchen Hand I": 0, "Kitchen Hand II": 10, "Kitchen Hand III": 20, "Apprentice Cook I": 40, "Apprentice Cook II": 80, "Apprentice Cook III": 120, "Sous Chef I": 160, "Sous Chef II": 240, "Sous Chef III": 280, "Head Chef I": 320, "Head Chef II": 400, "Head Chef III": 500, "Culinary Virtuoso I": 600, "Culinary Virtuoso II": 700, "Culinary Virtuoso III": 800, "Master of Flavour I": 900, "Master of Flavour II": 1000, "Master of Flavour III": 1200, "MAX": 1400};
const dishes = [ { name: "Gilded Shore Risotto", cookTimeHr: 8, exp: 4 }, { name: "Farmstead Feast Roast", cookTimeHr: 6, exp: 3 }, { name: "Woodland Mushroom Risotto", cookTimeHr: 4, exp: 2 }, { name: "Braised Venison Stew", cookTimeHr: 8, exp: 4 }, { name: "Hearty Custard Pie", cookTimeHr: 6, exp: 3 }, { name: "Paleleaf Meat Roll", cookTimeHr: 6, exp: 3 }, { name: "Saltbaked Shrimp", cookTimeHr: 6, exp: 3 },  ];
const talentTimeReduction = { 0: 0, 1: 0.05, 2: 0.10, 3: 0.15, 4: 0.20, 5: 0.25 };
const researchTaskMap = {
  1: ["ðŸ³ 60 any quality", "ðŸ’° 30 Epic+", "ðŸ³ 20 Legendary", "ðŸ³ 100 in gauntlet (3+ recipes)"],
  2: ["ðŸ³ 60 Epic+", "ðŸ’° 10 Legendary", "ðŸ³ 200 in gauntlet (3+ recipes)", "ðŸ½ï¸ 1"],
  3: ["ðŸ³ 80 Legendary", "ðŸ³ 200 in gauntlet (3+ recipes)", "ðŸ³ 5 in 1 gauntlet (3+ recipes) * 20", "ðŸ½ï¸ 1"],
  4: ["ðŸ³ 80 any quality", "ðŸ’° 10 Legendary", "Complete 30 gauntlets (2400+ score)", "ðŸŽ 1"],
  5: ["ðŸ³ 100 any quality", "Complete 150 gauntlets", "ðŸ³ 5 in 1 gauntlet (3+ recipes)", "ðŸ’° 20 Legendary"],
  6: ["ðŸ³ 80 any quality", "Complete 150 gauntlets", "ðŸ³5 in 1 gauntlet (3+ recipes) * 20", "ðŸ’° 10 Legendary"],
  7: ["ðŸ³ 100 any quality", "Complete 150 gauntlets", "ðŸ³ 5 in 1 gauntlet (3+ recipes)", "ðŸ’° 20 Legendary"],
};

document.getElementById("recipeSelect").addEventListener("change", function () {
  const selectedIndex = this.value;
  const tasks = researchTaskMap[selectedIndex];

  const taskContainer = document.getElementById("researchTasks");
  if (tasks && tasks.length > 0) {
    taskContainer.innerHTML = "<strong>Research Tasks:</strong><ul style='list-style-type: none; padding-left: 0;'>" + 
  tasks.map(task => `<li>${task}</li>`).join("") + 
  "</ul>";
  } else {
    taskContainer.innerHTML = "";
  }
});

function populateSelect(id, options) {
  const select = document.getElementById(id);
  options.forEach(opt => {
    const option = document.createElement('option');
    option.value = opt;
    option.textContent = opt;
    select.appendChild(option);
  });
}

populateSelect('currentLevel', levels);
populateSelect('targetLevel', levels);

function runCalculation() {
  const currentIndex = levels.indexOf(document.getElementById('currentLevel').value);
  const targetIndex = levels.indexOf(document.getElementById('targetLevel').value);
  let progress = parseFloat(document.getElementById('progress').value) || 0;
  const talentLevel = parseInt(document.getElementById('talentLevel').value);
  const delegatoLevel = parseInt(document.getElementById('delegatoLevel').value);
  const resultDiv = document.getElementById('result');

  if (currentIndex === -1 || targetIndex === -1 || targetIndex <= currentIndex) {
    resultDiv.textContent = 'Please select valid levels.';
    return;
  }

  let totalExpNeeded = 0;
  for (let i = currentIndex + 1; i <= targetIndex; i++) {
    totalExpNeeded += expPerLevel[levels[i]];
  }
  totalExpNeeded -= progress;
  if (totalExpNeeded < 0) totalExpNeeded = 0;

  const reduction = 1 - (talentTimeReduction[talentLevel] || 0);

  const dishesByExp = {};
  for (const dish of dishes) {
    if (!dishesByExp[dish.exp]) dishesByExp[dish.exp] = [];
    dishesByExp[dish.exp].push(dish);
  }

  const expValues = Object.keys(dishesByExp).map(Number).sort((a, b) => b - a);

  const [dish1] = dishesByExp[expValues[0]] || [];
  const [dish2] = dishesByExp[expValues[1]] || [];
  const [dish3] = dishesByExp[expValues[2]] || [];

  let bestCombo = null;

  for (let g = Math.floor(totalExpNeeded / expValues[0]); g >= 0; g--) {
    let rem1 = totalExpNeeded - g * expValues[0];
    for (let f = Math.floor(rem1 / expValues[1]); f >= 0; f--) {
      let rem2 = rem1 - f * expValues[1];
      if (rem2 % expValues[2] === 0) {
        let w = rem2 / expValues[2];
        bestCombo = { g, f, w };
        break;
      }
    }
    if (bestCombo) break;
  }

  if (!bestCombo) {
    resultDiv.textContent = "No efficient combination found.";
    return;
  }

  const totalCookTime =
    bestCombo.g * dish1.cookTimeHr * reduction +
    bestCombo.f * dish2.cookTimeHr * reduction +
    bestCombo.w * dish3.cookTimeHr * reduction;
  const realTime = totalCookTime / (delegatoLevel + 1);
  const days = Math.floor(realTime / 24);
  const hours = Math.round(realTime % 24);

  const expToDishes = {};
  for (const dish of dishes) {
    if (!expToDishes[dish.exp]) expToDishes[dish.exp] = [];
    expToDishes[dish.exp].push(dish);
  }

  const makeImageHTML = (dishes, count) => {
    const seen = new Set();
    let html = `${count} Ã— `;
    for (const dish of dishes) {
      if (seen.has(dish.name)) continue;
      seen.add(dish.name);
            const imgPath = `images/${dish.name.toLowerCase().replace(/\s+/g, ' ')}.png`;
      html += `<img src="${imgPath}" title="${dish.name}" style="max-width:40px;max-height:40px;margin:2px;vertical-align:middle;object-fit:contain;">`;
    }
    return html + '<br>';
  };

  let output = `EXP needed: ${totalExpNeeded}<br><br>Optimal Combo:<br>`;
  output += makeImageHTML(expToDishes[expValues[0]], bestCombo.g);
  output += makeImageHTML(expToDishes[expValues[1]], bestCombo.f);
  output += makeImageHTML(expToDishes[expValues[2]], bestCombo.w);
  output += `<br>Total time: ${days} day(s) and ${hours} hour(s)`;

  resultDiv.innerHTML = output;
}


function calculateTime() {
  const recipeIndex = parseInt(document.getElementById('recipeSelect').value);
  const dishCount = parseInt(document.getElementById('dishAmount').value);
  const flameLevel = parseInt(document.getElementById('timeTalentLevel').value);
  const delegato = parseInt(document.getElementById('timeDelegatoLevel').value);
  const reduction = 1 - talentTimeReduction[flameLevel];

  const totalCookTime = dishes[recipeIndex].cookTimeHr * dishCount * reduction;
  const parallel = delegato + 1;
  const realTime = totalCookTime / parallel;
  const days = Math.floor(realTime / 24);
  const hours = Math.round(realTime % 24);
  const totalExp = dishCount * dishes[recipeIndex].exp;

  document.getElementById('timeResult').textContent =
    `Total EXP: ${totalExp}\n\n` +
    `Total time: ${days} day(s) and ${hours} hour(s)`;
}
function populateSelectWithText(id, options) {
  const select = document.getElementById(id);
  select.innerHTML = '';
  options.forEach(opt => {
    const option = document.createElement('option');
    option.value = opt[0];
    option.textContent = opt; 
    select.appendChild(option);
  });
}
const talentOptions = [
  "0 (None)",
  "1 (5% faster, unlocks at Kitchen Hand I)",
  "2 (10% faster, unlocks at Apprentice cook I)",
  "3 (15% faster, unlocks at Sous Chef I)",
  "4 (20% faster, unlocks at Head Chef I)",
  "5 (25% faster, unlocks at Culinary Virtuoso I)"
];

populateSelectWithText('harvestTalent', talentOptions);
const commissionContainer = document.getElementById("commissionSelector");
const reservedContainer = document.getElementById("reservedSelectors");

for (let i = 0; i < 7; i++) {
  const wrapper = document.createElement("div");
  wrapper.className = "dish-group";
  const sel = document.createElement("select");
  sel.className = "dishOption";
  const defaultOption = document.createElement("option");
  defaultOption.value = "";
  defaultOption.textContent = " ";
  sel.appendChild(defaultOption);
  dishes.forEach((dish, idx) => {
    const option = document.createElement("option");
    option.value = idx;
    option.textContent = dish.name;
    sel.appendChild(option);
  });
  sel.addEventListener("mousedown", function() {
    this.selectedIndex = -1;
  });
  const result = document.createElement("div");
  result.className = "timestamp";
  result.style.display = "none";
  wrapper.appendChild(sel);
  wrapper.appendChild(result);

  if (i === 0) {
    commissionContainer.appendChild(wrapper);
  } else {
    reservedContainer.appendChild(wrapper);
  }
}

function calculateHarvestTimes() {
  const baseTime = new Date(document.getElementById("startTime").value);
  if (isNaN(baseTime)) {
    alert("Please enter a valid start time.");
    return;
  }

  const talent = parseInt(document.getElementById("harvestTalent").value);
  const reduction = 1 - talentTimeReduction[talent];
  const wrappers = document.querySelectorAll(".dish-group");

  const hoursInput = document.getElementById('commissionHours').value;
  const minutesInput = document.getElementById('commissionMinutes').value;
  const commissionTimeLeftMinutes = (parseInt(hoursInput) || 0) * 60 + (parseInt(minutesInput) || 0);

  let cumulativeTimeMs = 0;
  let totalExp = 0;

  wrappers.forEach((wrapper, index) => {
    const sel = wrapper.querySelector(".dishOption");
    const resultDiv = wrapper.querySelector(".timestamp");
    resultDiv.innerHTML = "";
    if (!sel.value) {
      resultDiv.style.display = "none";
      return;
    }

    const dish = dishes[parseInt(sel.value)];
    let cookTimeMs = dish.cookTimeHr * 3600000 * reduction;

    if (index === 0 && commissionTimeLeftMinutes > 0) {
      cookTimeMs = commissionTimeLeftMinutes * 60000;
    }

    cumulativeTimeMs += cookTimeMs;
    totalExp += dish.exp;

    const readyTime = new Date(baseTime.getTime() + cumulativeTimeMs);
    const timestampUnix = Math.floor(readyTime.getTime() / 1000);
    const discordTimestamp = `<t:${timestampUnix}:t>`;
    const copyContent = `${dish.name} â†’ ${discordTimestamp}`;

    const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    const formattedTime = `${months[readyTime.getMonth()]} ${readyTime.getDate().toString().padStart(2, '0')} ${readyTime.getHours().toString().padStart(2, '0')}:${readyTime.getMinutes().toString().padStart(2, '0')}`;

    resultDiv.innerHTML = `${formattedTime} <img class="copy-image" src="https://cdn-icons-png.flaticon.com/512/60/60990.png" alt="Copy" title="Copy timestamp" onclick="navigator.clipboard.writeText('${copyContent}')" />`;
    resultDiv.setAttribute("data-discord", copyContent);
    resultDiv.style.display = "flex";
  });

  const expDiv = document.getElementById("harvestTotalExp");

  if (totalExp > 0) {
    const oldIcon = expDiv.querySelector("img.copy-image");
    if (oldIcon) oldIcon.remove();

    const copyAllImage = document.createElement("img");
    copyAllImage.src = "https://cdn-icons-png.flaticon.com/512/60/60990.png";
    copyAllImage.alt = "Copy All";
    copyAllImage.className = "copy-image";
    copyAllImage.title = "Copy all timestamps";

    copyAllImage.onclick = () => {
      const allTimestamps = Array.from(document.querySelectorAll(".timestamp"))
        .map(div => div.getAttribute("data-discord"))
        .filter(Boolean)
        .join("\n");

      navigator.clipboard.writeText(allTimestamps);
    };

    expDiv.innerHTML = `Total EXP: ${totalExp} `;
    expDiv.appendChild(copyAllImage);
    expDiv.style.display = "block";
  } else {
    expDiv.style.display = "none";
  }
}

function switchTab(tabId) {
  const tabs = ["expTab", "researchTab", "harvestTab"];
  tabs.forEach(t => document.getElementById(t).style.display = t === tabId ? 'block' : 'none');
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
}
  window.addEventListener('DOMContentLoaded', () => {
    const now = new Date();
    now.setSeconds(0, 0);

    const pad = n => n.toString().padStart(2, '0');

    const localDateTime = `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;

    document.getElementById('startTime').value = localDateTime;
  });
</script>
</body>
</html>



